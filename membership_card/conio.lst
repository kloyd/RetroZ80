                        ;; Console I/O test for TIL design.

                        ; Input Restrictions
      = 00FF            BUFFER_SIZE EQU 255

                        ;; Handy Constants
      = 000D            CR	EQU     0DH
      = 000A            LF	EQU     0AH
      = 0024            DOLLAR  EQU     24H
      = 001B            ESC     EQU     1BH
      = 0003            CTRLC   EQU     03H

                        ; Screen print calls
      = 0001            CHAR_IN EQU     01H
      = 0009            WRITESTR        EQU     9H
      = 0002            PRTCHR  EQU     02H
      = 0005            BDOS    EQU     05H

                        ;       CP/M User program space starts at Page 1.
0100                            ORG     100h

0100                    MAIN:
0100  11 3C01                   LD      DE, GREET
0103  CD 3001                   CALL PUTS
0106  11 4F01                   LD      DE, PROMPT
0109  CD 3001                   CALL PUTS

010C                    READING:
010C  CD 1201                   CALL INPUT
010F  C3 0C01                   JP READING

0112                    INPUT:
0112  0E 01                     LD C, CHAR_IN
                                ;LD DE,0
0114  CD 0500                   CALL BDOS
                                ;OR A
                                ;JR Z,INPUT
                        	
0117  FE 03                     CP 03H
0119  CA 2701                   JP Z, EXIT

011C  FE 0D                     CP 0DH
011E  CA 2701                   JP Z, EXIT

0121  57                        LD D, A
0122  5F                        LD E, A
0123  CD 3601                   CALL PUTC
0126  C9                        RET

0127  11 5201           EXIT    LD      DE, EXITSTR
012A  CD 3001                   CALL    PUTS
                                ; CP/M Warm Boot
012D  C3 0000                   JP 0h

                        ; Print a string
0130                    PUTS:
                        ;;; Question, should we PUSH C and POP C here?
0130  0E 09                     LD C, WRITESTR
0132  CD 0500                   CALL BDOS
0135  C9                        RET

                        ; Print a character
0136                    PUTC:
0136  0E 02               LD C, PRTCHR
0138  CD 0500             CALL BDOS
013B  C9                  RET


013C  48454C4C 4F2C2049 GREET: DB "HELLO, I'M A TIL", CR, LF, DOLLAR
0144  274D2041 2054494C
014C  0D0A24
014F  3E2024            PROMPT: DB "> ", DOLLAR
0152  0D0A4B2C 20546878 EXITSTR: DB CR, LF, "K, Thx, Bye!", CR, LF, DOLLAR
015A  2C204279 65210D0A
0162  24

                        ;; Buffer at end of memory.
0163   (00FF)           BUFFER: DS BUFFER_SIZE



                                ; Need 0000 for asmx to generate correct Intel HEX.
0262   (0000)                   END 0000

BDOS               0005 E  BUFFER             0163    BUFFER_SIZE        00FF E
CHAR_IN            0001 E  CR                 000D E  CTRLC              0003 E
DOLLAR             0024 E  ESC                001B E  EXIT               0127
EXITSTR            0152    GREET              013C    INPUT              0112
LF                 000A E  MAIN               0100    PROMPT             014F
PRTCHR             0002 E  PUTC               0136    PUTS               0130
READING            010C    WRITESTR           0009 E
